<Window x:Class="CMC.MainWindow"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
       xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
       mc:Ignorable="d"
       Title="DSKY-Ex"
       Width="695"
       Height="800"
       MinWidth="348"
       MinHeight="400"
       ResizeMode="CanResize"
       Topmost="True"
       WindowStyle="None"
       Background="Transparent"
       WindowStartupLocation="CenterScreen"
       AllowsTransparency="True"
       Icon="pack://application:,,,/Assets/AGC.ico"
       SnapsToDevicePixels="True">

       <!-- Borderless resizing support -->
       <shell:WindowChrome.WindowChrome>
              <shell:WindowChrome CaptionHeight="0"
                     ResizeBorderThickness="6"
                     CornerRadius="0"
                     GlassFrameThickness="0"
                     UseAeroCaptionButtons="False" />
       </shell:WindowChrome.WindowChrome>

       <Window.Resources>
              <!-- Template to suppress default hover visuals -->
              <ControlTemplate x:Key="NoMouseOverButtonTemplate" TargetType="Button">
                     <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                   VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                     </Border>
              </ControlTemplate>

              <!-- Hitbox buttons: Transparent background for reliable hit testing -->
              <Style x:Key="HitBoxButtonStyle" TargetType="{x:Type Button}">
                     <Setter Property="Template" Value="{StaticResource NoMouseOverButtonTemplate}" />
                     <Setter Property="Background" Value="Transparent" />
                     <Setter Property="BorderBrush" Value="#00000000" />
                     <Setter Property="BorderThickness" Value="0" />
                     <Setter Property="Focusable" Value="False" />

                     <!-- Keypad press shadow effect (applies to functional hitboxes like Verb/Noun/etc.) -->
                     <EventSetter Event="PreviewMouseLeftButtonDown" Handler="FunctionalButton_MouseDown" />
                     <EventSetter Event="PreviewMouseLeftButtonUp" Handler="FunctionalButton_MouseUp" />
                     <EventSetter Event="MouseLeave" Handler="FunctionalButton_MouseLeave" />
              </Style>

              <!-- Icon buttons: DO NOT set Background here (so Button.Background can be set in XAML) -->
              <Style x:Key="IconButtonStyle" TargetType="{x:Type Button}">
                     <Setter Property="Template" Value="{StaticResource NoMouseOverButtonTemplate}" />
                     <Setter Property="BorderBrush" Value="#00000000" />
                     <Setter Property="BorderThickness" Value="0" />
                     <Setter Property="Focusable" Value="False" />
                     <Setter Property="Background" Value="Transparent" />
              </Style>

              <!-- Hover-only icon (invisible until hovered) -->
              <Style x:Key="HoverOnlyIconButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource IconButtonStyle}">
                     <Setter Property="Opacity" Value="0" />
                     <Setter Property="Cursor" Value="Hand" />
                     <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                   <Setter Property="Opacity" Value="1" />
                            </Trigger>
                     </Style.Triggers>
              </Style>
       </Window.Resources>

       <!-- proportional scaling after launch -->
       <Viewbox Stretch="Uniform" StretchDirection="Both">
              <!-- SINGLE coordinate space -->
              <Grid x:Name="RootGrid" Width="695" Height="800">

                     <!-- Background image (same coordinate space as hitboxes) -->
                     <Border SnapsToDevicePixels="True">
                            <Image x:Name="MainBackgroundImage"
                            Source="pack://application:,,,/Assets/Images/agc-bg.png"
                            Stretch="Fill"
                            Panel.ZIndex="0"
                            IsHitTestVisible="False" />
                     </Border>

                     <!-- Keypad backlight overlay (BrightnessIntegral: 0 → full, 1.4 → none) -->
                     <Image x:Name="KeypadBacklightOverlay"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/keypad_bcklt.png"
                            Stretch="Fill"
                            Panel.ZIndex="2"
                            IsHitTestVisible="False"
                            Opacity="0" />

                     <!-- Display backlight overlay (BrightnessNumerics: 0 → full, 1.4 → none) -->
                     <Image x:Name="DisplayBacklightOverlay"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/display_bcklt.png"
                            Stretch="Fill"
                            Panel.ZIndex="3"
                            IsHitTestVisible="False"
                            Opacity="0" />

                     <!-- Keypad press shadow overlay (shown while any functional HitBox button is pressed) -->
                     <Image x:Name="KeypressShadow" Panel.ZIndex="19"
                            HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/keypress.png"
                            Visibility="Collapsed"
                            IsHitTestVisible="False" />

                     <!-- Labels (LCD digits) on top -->
                     <Label x:Name="Prog" Content="" Margin="538,85,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" 
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="116" Panel.ZIndex="5"/>
                     <Label x:Name="Verb" Content="" Margin="408,182,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="116" Panel.ZIndex="5"/>
                     <Label x:Name="Noun" Content="" Margin="538,182,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="116" Panel.ZIndex="5"/>
                     <Label x:Name="Register2" Content="" Margin="401,328,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="217" Panel.ZIndex="5"/>
                     <Label x:Name="Register1" Content="" Margin="401,254,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="217" Panel.ZIndex="5"/>
                     <Label x:Name="Register3" Content="" Margin="401,403,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Foreground="#FF03A95A" FontSize="56" FontFamily="pack://application:,,,/Assets/Fonts/#Zerlina" Width="217" Panel.ZIndex="5"/>

                     <!-- Annunciator lit images -->
                     <Image x:Name="CompActy" Visibility="Hidden" Height="91" Width="91" Stretch="Fill" 
                            Margin="398,51,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/compacty.png"
                            Panel.ZIndex="3" IsHitTestVisible="False"/>

                     <Image x:Name="Temp" Height="50" Width="106" Stretch="Fill" Margin="188,52,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/temp.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="Gimballock" Height="50" Width="106" Stretch="Fill" Margin="188,108,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/gimballock.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="Program" Height="50" Width="106" Stretch="Fill" Margin="188,167,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/prog.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="Restart" Height="50" Width="106" Stretch="Fill" Margin="188,228,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/restart.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="Tracker" Height="50" Width="106" Stretch="Fill" Margin="188,290,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/tracker.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>

                     <Image x:Name="UplinkActy" Height="50" Width="106" Stretch="Fill" Margin="75,52,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/uplinkacty.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="NoAtt" Height="50" Width="106" Stretch="Fill" Margin="75,108,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/noatt.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="Stby" Height="50" Width="106" Stretch="Fill" Margin="75,167,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/stby.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="KeyRel" Height="50" Width="106" Stretch="Fill" Margin="75,228,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/keyrel.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="OprErr" Height="50" Width="106" Stretch="Fill" Margin="75,290,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/lit/oprerr.png"
                            Panel.ZIndex="3" IsHitTestVisible="False" Visibility="Collapsed"/>

                     <Grid x:Name="LmOnlyPanel" Visibility="Collapsed" Panel.ZIndex="3">
                            <Image x:Name="Alt" Height="50" Width="106" Stretch="Fill" Margin="188,351,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/lit/alt.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                            <Image x:Name="Vel" Height="50" Width="106" Stretch="Fill" Margin="188,412,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/lit/vel.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                     </Grid>

                     <!-- Annunciator background images -->
                     <Image x:Name="TempBack" Height="50" Width="106" Stretch="Fill" Margin="188,52,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/temp.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="GimballockBack" Height="50" Width="106" Stretch="Fill" Margin="188,108,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/gimballock.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="ProgramBack" Height="50" Width="106" Stretch="Fill" Margin="188,167,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/prog.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="RestartBack" Height="50" Width="106" Stretch="Fill" Margin="188,228,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/restart.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="TrackerBack" Height="50" Width="106" Stretch="Fill" Margin="188,290,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/tracker.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>

                     <Image x:Name="UplinkActyBack" Height="50" Width="106" Stretch="Fill" Margin="75,52,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/uplinkacty.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="NoAttBack" Height="50" Width="106" Stretch="Fill" Margin="75,108,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/noatt.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="StbyBack" Height="50" Width="106" Stretch="Fill" Margin="75,167,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/stby.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="KeyRelBack" Height="50" Width="106" Stretch="Fill" Margin="75,228,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/keyrel.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>
                     <Image x:Name="OprErrBack" Height="50" Width="106" Stretch="Fill" Margin="75,290,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                            Source="pack://application:,,,/Assets/Images/lights/unlit/oprerr.png"
                            Panel.ZIndex="2" IsHitTestVisible="False" Visibility="Collapsed"/>

                     <Grid x:Name="LmOnlyPanelBack" Visibility="Collapsed" Panel.ZIndex="2">
                            <Image x:Name="AltBack" Height="50" Width="106" Stretch="Fill" Margin="188,351,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/unlit/alt.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                            <Image x:Name="VelBack" Height="50" Width="106" Stretch="Fill" Margin="188,412,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/unlit/vel.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                            <Image x:Name="Unlit1" Height="50" Width="106" Stretch="Fill" Margin="75,351,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/unlit/unlit.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                            <Image x:Name="Unlit2" Height="50" Width="106" Stretch="Fill" Margin="75,412,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"
                                   Source="pack://application:,,,/Assets/Images/lights/unlit/unlit.png"
                                   IsHitTestVisible="False" Visibility="Collapsed"/>
                     </Grid>

                     <!-- Hitbox buttons (ON TOP of everything) -->
                     <Button x:Name="KeyRSET"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="587,648,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="88" Height="88"
                            Click="KeyRSET_Click"/>
                     <Button x:Name="KeyKeyRel" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="492,695,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="KeyKeyRel_Click"/>
                     <Button x:Name="KeyPro"    Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="492,601,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Pro_Click"/>
                     <Button x:Name="KeyVerb"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="20,554,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Verb_Click"/>
                     <Button x:Name="KeyNoun"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="20,648,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="KeyNoun_Click"/>
                     <Button x:Name="KeyEntr"   Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="587,554,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="88" Height="88"
                            Click="KeyEntr_Click"/>
                     <Button x:Name="KeyClear"  Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="492,507,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="KeyClear_Click"/>

                     <Button x:Name="KeyMinus"  Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="114,601,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="KeyMinus_Click"/>
                     <Button x:Name="KeyPluss"  Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="114,507,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="KeyPluss_Click"/>

                     <Button x:Name="Key0" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="115,694,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key0_Click"/>
                     <Button x:Name="Key1" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="209,695,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key1_Click"/>
                     <Button x:Name="Key2" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="303,695,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key2_Click"/>
                     <Button x:Name="Key3" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="397,695,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key3_Click"/>

                     <Button x:Name="Key4" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="209,601,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key4_Click"/>
                     <Button x:Name="Key5" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="303,601,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key5_Click"/>
                     <Button x:Name="Key6" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="397,601,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key6_Click"/>

                     <Button x:Name="Key7" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="209,507,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key7_Click"/>
                     <Button x:Name="Key8" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="303,507,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key8_Click"/>
                     <Button x:Name="Key9" Style="{StaticResource HitBoxButtonStyle}" Panel.ZIndex="20"
                            Margin="397,507,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="89" Height="89"
                            Click="Key9_Click"/>

                     <!-- Icon buttons (no double Background assignment) -->
                     <Button x:Name="DarkMode" Style="{StaticResource IconButtonStyle}" Panel.ZIndex="30"
                            Margin="42,744,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="40" Height="40"
                            Click="DarkMode_Click">
                            <Button.Background>
                                   <ImageBrush ImageSource="pack://application:,,,/Assets/Images/darkmode.png"/>
                            </Button.Background>
                     </Button>

                     <!-- Close button: top-right, only visible when hovered -->
                     <Button x:Name="CloseButton" Style="{StaticResource HoverOnlyIconButtonStyle}" Panel.ZIndex="50"
                            Margin="659,11,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="26" Height="26"
                            Click="CloseButton_Click">
                            <Button.Background>
                                   <ImageBrush ImageSource="pack://application:,,,/Assets/Images/close.png" Stretch="Uniform"/>
                            </Button.Background>
                     </Button>

                     <Button x:Name="PowerJSONReader" Style="{StaticResource IconButtonStyle}" Panel.ZIndex="30"
                            Margin="609,747,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="34" Height="34"
                            Click="Button_Click"
                            >
                            <Button.Background>
                                   <ImageBrush ImageSource="pack://application:,,,/Assets/Images/power-off.png" Stretch="Uniform"/>
                            </Button.Background>
                     </Button>
              </Grid>
       </Viewbox>
</Window>
